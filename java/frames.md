---
layout  : wiki
title   : 
summary : 
date    : 2022-08-23 01:36:40 +0900
updated : 2022-08-23 01:36:52 +0900
tags    : 
toc     : true
public  : true
parent  : 
latex   : false
---
* TOC
{:toc}

# 

## frames

프레임은 데이터와 중간 결과(partial results) 저장, dynamic linking, 메서드에 값 반환하기, 예외 부르기 등에 쓰인다.

메서드가 호출될 때마다 새로운 프레임이 생긴다. 프레임과 연관된 메서드 호출이 완료되면 그 프레임은 사라지며, 이는 메서드 호출 완료가 정상적이거나 예상 못했거나 상관없이 사라진다. 프레임은 쓰레드의 JVM 스택이 할당한다. 각 프레임은 지역 변수 배열, 피연산자 스택, 현재 메서드가 위치한 클래스의 run-time constant pool에 대한 참조를 갖는다.

지역 변수 배열과 피연산자 스택의 크기는 compile-time에 정해지며 프레임과 연관된 메서드 코드와 함께 전달된다(**Q1**). 그러므로 프레임 자료 구조의 크기는 오직 JVM의 구현 방법에 따라 다르며, 이 자료 구조에 사용되는 메모리를 메서드 호출과 동시에 할당할 수 있다.

제어 중인 쓰레드의 어느 시점에서든, 실행 중인 메서드에 대한 프레임 하나만 활성화되어 있다. 이러한 활성 상태인 프레임을 현재 프레임(current frame)이라고 부르고, 이 프레임과 연결된 메서드를 현재 메서드(current method)라고 부른다. 현재 메서드가 정의된 클래스를 현재 클래스(current class)라고 정의한다. 지역 변수와 피연산자 스택에 대한 연산은 보통 **현재 프레임에 대한 참조와 연관된다**(with reference to the current frame).

프레임의 메서드가 끝나거나 이 메서드가 또다른 메서드를 부르게 되면 현재 메서드에 해당하는 메서드가 바뀐다. 또다른 메서드를 호출할 경우 새로운 프레임이 생성되며, 이 메서드로 제어권이 넘어오면 이 프레임이 현재 프레임이 된다. 메서드가 반환하면, 현재 프레임은 자신의 메서드가 호출되어 만들어낸 결과를 이전 프레임으로 전달한다 (만약 전달할 것이 있다면). 이후 이전 프레임이 현재 프레임이 된다.

참고로 쓰레드가 만든 프레임은 그 쓰레드 안으로 범위가 한정되며 다른 쓰레드가 참조할 수 없다.

**Q1. 어디로 전달되나?**

## local variables

프레임마다 지역 변수(local variables)의 배열이 있다. 프레임의 지역 변수 배열 길이는 compile-time에 정해지고, 프레임에 연관된 메서드의 코드와 함께 클래스나 인터페이스의 이진 표현으로 주어진다.

지역 변수 하나가 가지고 있을 수 있는 값의 타입은 boolean, byte, char, short, int, float, reference, returnAddress 중 하나다. 지역 변수 한 쌍은 long이나 double 타입 값을 가지고 있을 수 있다(**Q2**).

**Q2. 여기서 말하는 지역 변수는 일반적으로 알고 있는 지역 변수가 아닌 것 같다. 메모리 수준에서의 개념을 말하는 것 같다.**

지역 변수 위치는 인덱스로 정한다. 첫번째 지역 변수의 인덱스는 0이다. 정수를 지역 변수 배열에 대한 인덱스로 볼 수 있는데, 그 정수가 0과 지역 변수 배열 크기보다 1 작은 값 사이에 있을 때만 가능하다.

long이나 double 타입 값은 연속되는 두 지역 변수를 차지한다. 이러한 값의 위치는 더 작은 인덱스 값으로만 찾을 수 있다. 예를 들어, double 타입 값이 지역 변수 배열의 n 인덱스에 저장된 경우, 실제로 이 값은 n과 n+1 인덱스 값을 모두 차지한다; 그러나, n+1 인덱스 값 지역 변수는 불러올 수 없다. 이 인덱스에 지역 변수를 저장할 수는 있지만, 그렇게 하면 n 인덱스 안에 담긴 지역 변수를 유효하지 않게 만든다.

JVM에서 n은 짝수가 아니어도 괜찮다.

JVM은 메서드 호출에 매개변수를 전달하기 위해 지역 변수를 사용한다. 클래스 메서드 호출 시, 어떤 매개변수라도 0 인덱스 값에서 시작해서 연속되는 지역 변수를 전달한다. 인스턴스 메서드 호출 시, 0 인덱스의 지역 변수는 해당 인스턴스 메서드가 호출되는 객체의 참조를 전달하는 데 사용된다 (Java 언어에서 this를 의미). 따라서 모든 매개변수에 1 인덱스부터의 지역 변수가 전달된다.
